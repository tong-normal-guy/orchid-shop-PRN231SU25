@page
@model OrchidsShop.PresentationLayer.Pages.AccountModel
@{
    ViewData["Title"] = "My Account";
    ViewData["ActivePage"] = "Account";
}

@{
    var userEmail = ViewContext.HttpContext.Session.GetString("UserEmail");
    var userName = ViewContext.HttpContext.Session.GetString("UserName");
    var isLoggedIn = !string.IsNullOrEmpty(userEmail);
}

<div class="container mt-4">
    @if (!isLoggedIn)
    {
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow-soft">
                    <div class="card-body text-center p-5">
                        <i class="bi bi-lock text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
                        <h4 class="mt-3">Authentication Required</h4>
                        <p class="text-muted mb-4">Please sign in to view your account details.</p>
                        <div class="d-flex gap-3 justify-content-center">
                            <a asp-page="/Auth/Login" class="btn btn-primary">
                                <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
                            </a>
                            <a asp-page="/Auth/Register" class="btn btn-outline-primary">
                                <i class="bi bi-person-plus me-2"></i>Create Account
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <!-- Profile Header -->
            <div class="col-12 mb-4">
                <div class="card shadow-soft">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="position-relative d-inline-block">
                                    <img src="https://via.placeholder.com/120x120/8b4f9f/ffffff?text=@(userName?.Substring(0, 1).ToUpper() ?? "U")" 
                                         class="rounded-circle" width="120" height="120" alt="Profile Picture">
                                    <button class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle" 
                                            style="width: 32px; height: 32px; padding: 0;" onclick="changeProfilePicture()">
                                        <i class="bi bi-camera"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h3 class="mb-1">@(userName ?? userEmail?.Split('@')[0] ?? "User")</h3>
                                <p class="text-muted mb-2">@userEmail</p>
                                <div class="d-flex gap-2 flex-wrap">
                                    <span class="badge bg-primary">Customer</span>
                                    <span class="badge bg-success">Verified</span>
                                    <span class="badge bg-warning">Gold Member</span>
                                </div>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-outline-primary" onclick="editProfile()">
                                    <i class="bi bi-pencil me-1"></i>Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Account Information -->
            <div class="col-lg-8">
                <div class="card shadow-soft mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-person me-2"></i>Account Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="profileForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" value="@(userName?.Split(' ')[0] ?? "")" disabled>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" value="@(userName?.Split(' ').Length > 1 ? userName.Split(' ')[1] : "")" disabled>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" value="@userEmail" disabled>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" placeholder="(555) 123-4567" disabled>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" placeholder="123 Main Street" disabled>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-control" placeholder="City" disabled>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">State</label>
                                    <input type="text" class="form-control" placeholder="State" disabled>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" placeholder="12345" disabled>
                                </div>
                            </div>
                            <div class="text-end">
                                <button type="button" class="btn btn-secondary me-2" onclick="cancelEdit()" style="display: none;" id="cancelBtn">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="saveProfile()" style="display: none;" id="saveBtn">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="card shadow-soft mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-shield-lock me-2"></i>Security Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
                            <div>
                                <h6 class="mb-1">Password</h6>
                                <small class="text-muted">Last changed 30 days ago</small>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="changePassword()">
                                <i class="bi bi-key me-1"></i>Change Password
                            </button>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
                            <div>
                                <h6 class="mb-1">Two-Factor Authentication</h6>
                                <small class="text-muted">Add an extra layer of security</small>
                            </div>
                            <button class="btn btn-outline-success btn-sm" onclick="enable2FA()">
                                <i class="bi bi-shield-check me-1"></i>Enable
                            </button>
                        </div>
                        <div class="d-flex justify-content-between align-items-center p-3 border rounded">
                            <div>
                                <h6 class="mb-1">Login Sessions</h6>
                                <small class="text-muted">Manage your active sessions</small>
                            </div>
                            <button class="btn btn-outline-info btn-sm" onclick="viewSessions()">
                                <i class="bi bi-list-ul me-1"></i>View Sessions
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Summary & Quick Actions -->
            <div class="col-lg-4">
                <!-- Account Stats -->
                <div class="card shadow-soft mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-graph-up me-2"></i>Account Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="row">
                                <div class="col-6">
                                    <h4 class="text-primary mb-1">3</h4>
                                    <small class="text-muted">Total Orders</small>
                                </div>
                                <div class="col-6">
                                    <h4 class="text-success mb-1">$201.47</h4>
                                    <small class="text-muted">Total Spent</small>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="row">
                                <div class="col-6">
                                    <h4 class="text-warning mb-1">4</h4>
                                    <small class="text-muted">Orchids Bought</small>
                                </div>
                                <div class="col-6">
                                    <h4 class="text-info mb-1">15</h4>
                                    <small class="text-muted">Reviews Written</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card shadow-soft mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-lightning me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a asp-page="/Orders" class="btn btn-outline-primary">
                                <i class="bi bi-box-seam me-2"></i>View Orders
                            </a>
                            <a asp-page="/Cart" class="btn btn-outline-secondary">
                                <i class="bi bi-cart3 me-2"></i>View Cart
                            </a>
                            <a href="/?view=products" class="btn btn-outline-success">
                                <i class="bi bi-flower1 me-2"></i>Browse Orchids
                            </a>
                            <button class="btn btn-outline-info" onclick="downloadData()">
                                <i class="bi bi-download me-2"></i>Download My Data
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteAccount()">
                                <i class="bi bi-trash me-2"></i>Delete Account
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Preferences -->
                <div class="card shadow-soft">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-gear me-2"></i>Preferences
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                            <label class="form-check-label" for="emailNotifications">
                                Email Notifications
                            </label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="smsNotifications">
                            <label class="form-check-label" for="smsNotifications">
                                SMS Notifications
                            </label>
                        </div>
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="marketingEmails" checked>
                            <label class="form-check-label" for="marketingEmails">
                                Marketing Emails
                            </label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="orderUpdates" checked>
                            <label class="form-check-label" for="orderUpdates">
                                Order Updates
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function editProfile() {
            // Enable form inputs
            $('#profileForm input').prop('disabled', false);
            $('#saveBtn, #cancelBtn').show();
            $('[onclick="editProfile()"]').hide();
        }

        function cancelEdit() {
            // Disable form inputs and reset values
            $('#profileForm input').prop('disabled', true);
            $('#saveBtn, #cancelBtn').hide();
            $('[onclick="editProfile()"]').show();
            
            // Reset form values here if needed
            showAlert('info', 'Changes cancelled');
        }

        function saveProfile() {
            // Simulate saving profile
            showAlert('success', 'Profile updated successfully!');
            cancelEdit();
        }

        function changeProfilePicture() {
            showAlert('info', 'Profile picture upload feature coming soon!');
        }

        function changePassword() {
            showAlert('info', 'Password change feature coming soon!');
        }

        function enable2FA() {
            showAlert('info', 'Two-factor authentication setup coming soon!');
        }

        function viewSessions() {
            showAlert('info', 'Active sessions management coming soon!');
        }

        function downloadData() {
            if (confirm('Download all your account data? This may take a few minutes.')) {
                showAlert('info', 'Data download request submitted. You will receive an email when ready.');
            }
        }

        function deleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                    showAlert('danger', 'Account deletion feature available on request. Please contact support.');
                }
            }
        }

        // Save preferences when changed
        $('.form-check-input').on('change', function() {
            const setting = $(this).attr('id');
            const enabled = $(this).is(':checked');
            
            // Simulate saving preference
            setTimeout(() => {
                showAlert('success', `${setting} ${enabled ? 'enabled' : 'disabled'}`, 2000);
            }, 500);
        });
    </script>
} 